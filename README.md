# Viz.js

[![Build Status](https://travis-ci.org/mdaines/viz.js.svg?branch=master)](https://travis-ci.org/mdaines/viz.js)

This project builds [Graphviz](http://www.graphviz.org) with [Emscripten](http://kripken.github.io/emscripten-site/) and provides a simple wrapper for using it in the browser.

## Getting Viz.js

To install with Yarn:

    yarn add viz.js

Or download from the [releases page](https://github.com/mdaines/viz.js/releases).

## Usage

Rendering a graph as an SVG element using a Web Worker:

```js
let viz = new Viz({ worker: 'path/to/full.js.opaque' );

viz.renderSVGElement('digraph { a -> b; }')
.then(element => {
  document.body.appendChild(element);
});
```

The input to `renderSVGElement` is a graph in the [DOT language](http://www.graphviz.org/content/dot-language).

For more information, see the [API documentation](https://github.com/mdaines/viz.js/wiki/API).

The Viz.js distribution is split into two parts. The API, `viz.js`, and the rendering script files, `full.js.opaque` and `lite.js.opaque`. The rendering script files include the code generated by Emscripten, and may be used in three ways:

* As a Web Worker. To do this, construct a `Viz` instance by passing the url of the rendering script file as the `worker` option.
* As a CommonJS module. To do this, require the rendering script file and pass its `render` export as the `render` option.
* Included using a `<script>` tag. To do this, include the rendering script file after Viz.js and don't pass any options when constructing an instance of `Viz`.

The "full" rendering script file supports HTML labels and the NEATO engine, while the "lite" one omits these.

The rendering script files are named with the ".js.opaque" suffix to allow them to be used more easily with JavaScript bundlers. For example, when importing one of these files in an application bootstrapped with Create React App, you'll get the public path rather than a binding. You can then pass the path to the `worker` option.

```js
import Viz from 'viz.js';
import fullWorker from 'viz.js/full.js.opaque';

let viz = new Viz({ worker: fullWorker });
// ...
```

For an example, see [viz-ui](https://github.com/mdaines/viz-ui).

## Building Viz.js

To build from source, you will need to [install the Emscripten SDK](http://kripken.github.io/emscripten-site/docs/getting_started/index.html).

Then, install the development dependencies using Yarn:

    yarn install

The build process for Viz.js is split into two parts: building the Graphviz and Expat dependencies, and building the rendering script files and API.

    make deps
    make all

## Running Browser Tests

The browser tests can be run locally using Selenium WebDriver.

First, serve the project directory at http://localhost:8000.

    python -m SimpleHTTPServer
    
Then, run tests using test-browser/runner.js. For example, to run `test-browser/full.html` in Chrome:

    node test-browser/runner --file full.html --browser chrome
